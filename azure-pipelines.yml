strategy:
  matrix:
    Python 3.7:
      template: 'ci/azure-pipelines-default-config.yml'
      python_version: '3.7'
    Python 3.6:
      template: 'ci/azure-pipelines-default-config.yml'
      python_version: '3.6'
    Python 3.5:
      template: 'ci/azure-pipelines-default-config.yml'
      python_version: '3.5'
    Array Function:
      template: 'ci/azure-pipelines-default-config.yml'
      NUMPY_EXPERIMENTAL_ARRAY_FUNCTION: '1'
      NUMPY_VERSION: '==1.16.2'
    MacOS:
      template: 'ci/azure-pipelines-default-config.yml'
      imageName: 'macos-10.13'
    Windows:
      template: 'ci/azure-pipelines-default-config.yml'
      imageName: 'vs2017-win2016'

pool:
  vmImage: '$(imageName)'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: $(python_version)
      architecture: "x64"

  - script: pip install -e .[all]
    displayName: Install package

  - script: |
      pip install numpy$NUMPY_VERSION;
      pip install -e .[tests]
      pip install codecov
    displayName: Run tests

  - task: PublishTestResults@2
    condition: always()
    inputs:
      testResultsFiles: "**/test-*.xml"
      testRunTitle: "Publish test results"

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: "$(System.DefaultWorkingDirectory)/**/coverage.xml"
      reportDirectory: "$(System.DefaultWorkingDirectory)/**/htmlcov"
